'use strict';function cov_2fic4cdd6w(){var path="/Users/sitita/ArubaSocketServer/lib/stream.js";var hash="8b9389eacffe871387afe346d9d0dc7d4803be50";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/sitita/ArubaSocketServer/lib/stream.js",statementMap:{"0":{start:{line:3,column:19},end:{line:3,column:36}},"1":{start:{line:12,column:2},end:{line:12,column:23}},"2":{start:{line:21,column:2},end:{line:23,column:3}},"3":{start:{line:22,column:4},end:{line:22,column:19}},"4":{start:{line:33,column:2},end:{line:33,column:46}},"5":{start:{line:34,column:2},end:{line:34,column:17}},"6":{start:{line:35,column:2},end:{line:38,column:3}},"7":{start:{line:37,column:4},end:{line:37,column:28}},"8":{start:{line:50,column:30},end:{line:50,column:34}},"9":{start:{line:53,column:4},end:{line:53,column:51}},"10":{start:{line:53,column:31},end:{line:53,column:51}},"11":{start:{line:56,column:2},end:{line:64,column:3}},"12":{start:{line:57,column:4},end:{line:60,column:7}},"13":{start:{line:58,column:6},end:{line:58,column:47}},"14":{start:{line:59,column:6},end:{line:59,column:48}},"15":{start:{line:62,column:4},end:{line:62,column:45}},"16":{start:{line:63,column:4},end:{line:63,column:46}},"17":{start:{line:66,column:17},end:{line:72,column:4}},"18":{start:{line:74,column:2},end:{line:79,column:5}},"19":{start:{line:75,column:4},end:{line:78,column:5}},"20":{start:{line:76,column:6},end:{line:76,column:36}},"21":{start:{line:77,column:6},end:{line:77,column:25}},"22":{start:{line:81,column:2},end:{line:85,column:5}},"23":{start:{line:82,column:4},end:{line:82,column:33}},"24":{start:{line:82,column:26},end:{line:82,column:33}},"25":{start:{line:84,column:4},end:{line:84,column:24}},"26":{start:{line:87,column:2},end:{line:91,column:5}},"27":{start:{line:88,column:4},end:{line:88,column:33}},"28":{start:{line:88,column:26},end:{line:88,column:33}},"29":{start:{line:90,column:4},end:{line:90,column:22}},"30":{start:{line:93,column:2},end:{line:112,column:4}},"31":{start:{line:94,column:4},end:{line:98,column:5}},"32":{start:{line:95,column:6},end:{line:95,column:20}},"33":{start:{line:96,column:6},end:{line:96,column:42}},"34":{start:{line:97,column:6},end:{line:97,column:13}},"35":{start:{line:100,column:17},end:{line:100,column:22}},"36":{start:{line:102,column:4},end:{line:105,column:7}},"37":{start:{line:103,column:6},end:{line:103,column:20}},"38":{start:{line:104,column:6},end:{line:104,column:20}},"39":{start:{line:107,column:4},end:{line:110,column:7}},"40":{start:{line:108,column:6},end:{line:108,column:33}},"41":{start:{line:108,column:19},end:{line:108,column:33}},"42":{start:{line:109,column:6},end:{line:109,column:42}},"43":{start:{line:111,column:4},end:{line:111,column:19}},"44":{start:{line:114,column:2},end:{line:140,column:4}},"45":{start:{line:115,column:4},end:{line:120,column:5}},"46":{start:{line:116,column:6},end:{line:118,column:9}},"47":{start:{line:117,column:8},end:{line:117,column:32}},"48":{start:{line:119,column:6},end:{line:119,column:13}},"49":{start:{line:126,column:4},end:{line:126,column:36}},"50":{start:{line:126,column:29},end:{line:126,column:36}},"51":{start:{line:128,column:4},end:{line:139,column:5}},"52":{start:{line:129,column:6},end:{line:129,column:17}},"53":{start:{line:130,column:6},end:{line:130,column:61}},"54":{start:{line:130,column:44},end:{line:130,column:61}},"55":{start:{line:132,column:6},end:{line:137,column:9}},"56":{start:{line:136,column:8},end:{line:136,column:19}},"57":{start:{line:138,column:6},end:{line:138,column:17}},"58":{start:{line:142,column:2},end:{line:147,column:4}},"59":{start:{line:143,column:4},end:{line:146,column:5}},"60":{start:{line:144,column:6},end:{line:144,column:35}},"61":{start:{line:145,column:6},end:{line:145,column:70}},"62":{start:{line:145,column:50},end:{line:145,column:70}},"63":{start:{line:149,column:2},end:{line:158,column:4}},"64":{start:{line:150,column:4},end:{line:155,column:5}},"65":{start:{line:151,column:6},end:{line:153,column:9}},"66":{start:{line:152,column:8},end:{line:152,column:49}},"67":{start:{line:154,column:6},end:{line:154,column:13}},"68":{start:{line:157,column:4},end:{line:157,column:29}},"69":{start:{line:160,column:2},end:{line:160,column:32}},"70":{start:{line:161,column:2},end:{line:161,column:36}},"71":{start:{line:162,column:2},end:{line:162,column:16}},"72":{start:{line:165,column:0},end:{line:165,column:39}}},fnMap:{"0":{name:"emitClose",decl:{start:{line:11,column:9},end:{line:11,column:18}},loc:{start:{line:11,column:27},end:{line:13,column:1}},line:11},"1":{name:"duplexOnEnd",decl:{start:{line:20,column:9},end:{line:20,column:20}},loc:{start:{line:20,column:23},end:{line:24,column:1}},line:20},"2":{name:"duplexOnError",decl:{start:{line:32,column:9},end:{line:32,column:22}},loc:{start:{line:32,column:28},end:{line:39,column:1}},line:32},"3":{name:"createWebSocketStream",decl:{start:{line:49,column:9},end:{line:49,column:30}},loc:{start:{line:49,column:44},end:{line:163,column:1}},line:49},"4":{name:"receiverOnDrain",decl:{start:{line:52,column:11},end:{line:52,column:26}},loc:{start:{line:52,column:29},end:{line:54,column:3}},line:52},"5":{name:"open",decl:{start:{line:57,column:29},end:{line:57,column:33}},loc:{start:{line:57,column:36},end:{line:60,column:5}},line:57},"6":{name:"message",decl:{start:{line:74,column:28},end:{line:74,column:35}},loc:{start:{line:74,column:41},end:{line:79,column:3}},line:74},"7":{name:"error",decl:{start:{line:81,column:28},end:{line:81,column:33}},loc:{start:{line:81,column:39},end:{line:85,column:3}},line:81},"8":{name:"close",decl:{start:{line:87,column:28},end:{line:87,column:33}},loc:{start:{line:87,column:36},end:{line:91,column:3}},line:87},"9":{name:"(anonymous_9)",decl:{start:{line:93,column:20},end:{line:93,column:21}},loc:{start:{line:93,column:45},end:{line:112,column:3}},line:93},"10":{name:"error",decl:{start:{line:102,column:30},end:{line:102,column:35}},loc:{start:{line:102,column:41},end:{line:105,column:5}},line:102},"11":{name:"close",decl:{start:{line:107,column:30},end:{line:107,column:35}},loc:{start:{line:107,column:38},end:{line:110,column:5}},line:107},"12":{name:"(anonymous_12)",decl:{start:{line:114,column:18},end:{line:114,column:19}},loc:{start:{line:114,column:38},end:{line:140,column:3}},line:114},"13":{name:"open",decl:{start:{line:116,column:31},end:{line:116,column:35}},loc:{start:{line:116,column:38},end:{line:118,column:7}},line:116},"14":{name:"finish",decl:{start:{line:132,column:41},end:{line:132,column:47}},loc:{start:{line:132,column:50},end:{line:137,column:7}},line:132},"15":{name:"(anonymous_15)",decl:{start:{line:142,column:17},end:{line:142,column:18}},loc:{start:{line:142,column:29},end:{line:147,column:3}},line:142},"16":{name:"(anonymous_16)",decl:{start:{line:149,column:18},end:{line:149,column:19}},loc:{start:{line:149,column:55},end:{line:158,column:3}},line:149},"17":{name:"open",decl:{start:{line:151,column:31},end:{line:151,column:35}},loc:{start:{line:151,column:38},end:{line:153,column:7}},line:151}},branchMap:{"0":{loc:{start:{line:21,column:2},end:{line:23,column:3}},type:"if",locations:[{start:{line:21,column:2},end:{line:23,column:3}},{start:{line:21,column:2},end:{line:23,column:3}}],line:21},"1":{loc:{start:{line:21,column:6},end:{line:21,column:53}},type:"binary-expr",locations:[{start:{line:21,column:6},end:{line:21,column:21}},{start:{line:21,column:25},end:{line:21,column:53}}],line:21},"2":{loc:{start:{line:35,column:2},end:{line:38,column:3}},type:"if",locations:[{start:{line:35,column:2},end:{line:38,column:3}},{start:{line:35,column:2},end:{line:38,column:3}}],line:35},"3":{loc:{start:{line:53,column:4},end:{line:53,column:51}},type:"if",locations:[{start:{line:53,column:4},end:{line:53,column:51}},{start:{line:53,column:4},end:{line:53,column:51}}],line:53},"4":{loc:{start:{line:56,column:2},end:{line:64,column:3}},type:"if",locations:[{start:{line:56,column:2},end:{line:64,column:3}},{start:{line:56,column:2},end:{line:64,column:3}}],line:56},"5":{loc:{start:{line:75,column:4},end:{line:78,column:5}},type:"if",locations:[{start:{line:75,column:4},end:{line:78,column:5}},{start:{line:75,column:4},end:{line:78,column:5}}],line:75},"6":{loc:{start:{line:82,column:4},end:{line:82,column:33}},type:"if",locations:[{start:{line:82,column:4},end:{line:82,column:33}},{start:{line:82,column:4},end:{line:82,column:33}}],line:82},"7":{loc:{start:{line:88,column:4},end:{line:88,column:33}},type:"if",locations:[{start:{line:88,column:4},end:{line:88,column:33}},{start:{line:88,column:4},end:{line:88,column:33}}],line:88},"8":{loc:{start:{line:94,column:4},end:{line:98,column:5}},type:"if",locations:[{start:{line:94,column:4},end:{line:98,column:5}},{start:{line:94,column:4},end:{line:98,column:5}}],line:94},"9":{loc:{start:{line:108,column:6},end:{line:108,column:33}},type:"if",locations:[{start:{line:108,column:6},end:{line:108,column:33}},{start:{line:108,column:6},end:{line:108,column:33}}],line:108},"10":{loc:{start:{line:115,column:4},end:{line:120,column:5}},type:"if",locations:[{start:{line:115,column:4},end:{line:120,column:5}},{start:{line:115,column:4},end:{line:120,column:5}}],line:115},"11":{loc:{start:{line:126,column:4},end:{line:126,column:36}},type:"if",locations:[{start:{line:126,column:4},end:{line:126,column:36}},{start:{line:126,column:4},end:{line:126,column:36}}],line:126},"12":{loc:{start:{line:128,column:4},end:{line:139,column:5}},type:"if",locations:[{start:{line:128,column:4},end:{line:139,column:5}},{start:{line:128,column:4},end:{line:139,column:5}}],line:128},"13":{loc:{start:{line:130,column:6},end:{line:130,column:61}},type:"if",locations:[{start:{line:130,column:6},end:{line:130,column:61}},{start:{line:130,column:6},end:{line:130,column:61}}],line:130},"14":{loc:{start:{line:143,column:4},end:{line:146,column:5}},type:"if",locations:[{start:{line:143,column:4},end:{line:146,column:5}},{start:{line:143,column:4},end:{line:146,column:5}}],line:143},"15":{loc:{start:{line:143,column:8},end:{line:143,column:59}},type:"binary-expr",locations:[{start:{line:143,column:8},end:{line:143,column:33}},{start:{line:143,column:37},end:{line:143,column:59}}],line:143},"16":{loc:{start:{line:145,column:6},end:{line:145,column:70}},type:"if",locations:[{start:{line:145,column:6},end:{line:145,column:70}},{start:{line:145,column:6},end:{line:145,column:70}}],line:145},"17":{loc:{start:{line:150,column:4},end:{line:155,column:5}},type:"if",locations:[{start:{line:150,column:4},end:{line:155,column:5}},{start:{line:150,column:4},end:{line:155,column:5}}],line:150}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8b9389eacffe871387afe346d9d0dc7d4803be50"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2fic4cdd6w=function(){return actualCoverage;};}return actualCoverage;}cov_2fic4cdd6w();const{Duplex}=(cov_2fic4cdd6w().s[0]++,require('stream'));/**
 * Emits the `'close'` event on a stream.
 *
 * @param {stream.Duplex} The stream.
 * @private
 */function emitClose(stream){cov_2fic4cdd6w().f[0]++;cov_2fic4cdd6w().s[1]++;stream.emit('close');}/**
 * The listener of the `'end'` event.
 *
 * @private
 */function duplexOnEnd(){cov_2fic4cdd6w().f[1]++;cov_2fic4cdd6w().s[2]++;if((cov_2fic4cdd6w().b[1][0]++,!this.destroyed)&&(cov_2fic4cdd6w().b[1][1]++,this._writableState.finished)){cov_2fic4cdd6w().b[0][0]++;cov_2fic4cdd6w().s[3]++;this.destroy();}else{cov_2fic4cdd6w().b[0][1]++;}}/**
 * The listener of the `'error'` event.
 *
 * @param {Error} err The error
 * @private
 */function duplexOnError(err){cov_2fic4cdd6w().f[2]++;cov_2fic4cdd6w().s[4]++;this.removeListener('error',duplexOnError);cov_2fic4cdd6w().s[5]++;this.destroy();cov_2fic4cdd6w().s[6]++;if(this.listenerCount('error')===0){cov_2fic4cdd6w().b[2][0]++;cov_2fic4cdd6w().s[7]++;// Do not suppress the throwing behavior.
this.emit('error',err);}else{cov_2fic4cdd6w().b[2][1]++;}}/**
 * Wraps a `WebSocket` in a duplex stream.
 *
 * @param {WebSocket} ws The `WebSocket` to wrap
 * @param {Object} [options] The options for the `Duplex` constructor
 * @return {stream.Duplex} The duplex stream
 * @public
 */function createWebSocketStream(ws,options){cov_2fic4cdd6w().f[3]++;let resumeOnReceiverDrain=(cov_2fic4cdd6w().s[8]++,true);function receiverOnDrain(){cov_2fic4cdd6w().f[4]++;cov_2fic4cdd6w().s[9]++;if(resumeOnReceiverDrain){cov_2fic4cdd6w().b[3][0]++;cov_2fic4cdd6w().s[10]++;ws._socket.resume();}else{cov_2fic4cdd6w().b[3][1]++;}}cov_2fic4cdd6w().s[11]++;if(ws.readyState===ws.CONNECTING){cov_2fic4cdd6w().b[4][0]++;cov_2fic4cdd6w().s[12]++;ws.once('open',function open(){cov_2fic4cdd6w().f[5]++;cov_2fic4cdd6w().s[13]++;ws._receiver.removeAllListeners('drain');cov_2fic4cdd6w().s[14]++;ws._receiver.on('drain',receiverOnDrain);});}else{cov_2fic4cdd6w().b[4][1]++;cov_2fic4cdd6w().s[15]++;ws._receiver.removeAllListeners('drain');cov_2fic4cdd6w().s[16]++;ws._receiver.on('drain',receiverOnDrain);}const duplex=(cov_2fic4cdd6w().s[17]++,new Duplex({...options,autoDestroy:false,emitClose:false,objectMode:false,writableObjectMode:false}));cov_2fic4cdd6w().s[18]++;ws.on('message',function message(msg){cov_2fic4cdd6w().f[6]++;cov_2fic4cdd6w().s[19]++;if(!duplex.push(msg)){cov_2fic4cdd6w().b[5][0]++;cov_2fic4cdd6w().s[20]++;resumeOnReceiverDrain=false;cov_2fic4cdd6w().s[21]++;ws._socket.pause();}else{cov_2fic4cdd6w().b[5][1]++;}});cov_2fic4cdd6w().s[22]++;ws.once('error',function error(err){cov_2fic4cdd6w().f[7]++;cov_2fic4cdd6w().s[23]++;if(duplex.destroyed){cov_2fic4cdd6w().b[6][0]++;cov_2fic4cdd6w().s[24]++;return;}else{cov_2fic4cdd6w().b[6][1]++;}cov_2fic4cdd6w().s[25]++;duplex.destroy(err);});cov_2fic4cdd6w().s[26]++;ws.once('close',function close(){cov_2fic4cdd6w().f[8]++;cov_2fic4cdd6w().s[27]++;if(duplex.destroyed){cov_2fic4cdd6w().b[7][0]++;cov_2fic4cdd6w().s[28]++;return;}else{cov_2fic4cdd6w().b[7][1]++;}cov_2fic4cdd6w().s[29]++;duplex.push(null);});cov_2fic4cdd6w().s[30]++;duplex._destroy=function(err,callback){cov_2fic4cdd6w().f[9]++;cov_2fic4cdd6w().s[31]++;if(ws.readyState===ws.CLOSED){cov_2fic4cdd6w().b[8][0]++;cov_2fic4cdd6w().s[32]++;callback(err);cov_2fic4cdd6w().s[33]++;process.nextTick(emitClose,duplex);cov_2fic4cdd6w().s[34]++;return;}else{cov_2fic4cdd6w().b[8][1]++;}let called=(cov_2fic4cdd6w().s[35]++,false);cov_2fic4cdd6w().s[36]++;ws.once('error',function error(err){cov_2fic4cdd6w().f[10]++;cov_2fic4cdd6w().s[37]++;called=true;cov_2fic4cdd6w().s[38]++;callback(err);});cov_2fic4cdd6w().s[39]++;ws.once('close',function close(){cov_2fic4cdd6w().f[11]++;cov_2fic4cdd6w().s[40]++;if(!called){cov_2fic4cdd6w().b[9][0]++;cov_2fic4cdd6w().s[41]++;callback(err);}else{cov_2fic4cdd6w().b[9][1]++;}cov_2fic4cdd6w().s[42]++;process.nextTick(emitClose,duplex);});cov_2fic4cdd6w().s[43]++;ws.terminate();};cov_2fic4cdd6w().s[44]++;duplex._final=function(callback){cov_2fic4cdd6w().f[12]++;cov_2fic4cdd6w().s[45]++;if(ws.readyState===ws.CONNECTING){cov_2fic4cdd6w().b[10][0]++;cov_2fic4cdd6w().s[46]++;ws.once('open',function open(){cov_2fic4cdd6w().f[13]++;cov_2fic4cdd6w().s[47]++;duplex._final(callback);});cov_2fic4cdd6w().s[48]++;return;}else{cov_2fic4cdd6w().b[10][1]++;}// If the value of the `_socket` property is `null` it means that `ws` is a
// client websocket and the handshake failed. In fact, when this happens, a
// socket is never assigned to the websocket. Wait for the `'error'` event
// that will be emitted by the websocket.
cov_2fic4cdd6w().s[49]++;if(ws._socket===null){cov_2fic4cdd6w().b[11][0]++;cov_2fic4cdd6w().s[50]++;return;}else{cov_2fic4cdd6w().b[11][1]++;}cov_2fic4cdd6w().s[51]++;if(ws._socket._writableState.finished){cov_2fic4cdd6w().b[12][0]++;cov_2fic4cdd6w().s[52]++;callback();cov_2fic4cdd6w().s[53]++;if(duplex._readableState.endEmitted){cov_2fic4cdd6w().b[13][0]++;cov_2fic4cdd6w().s[54]++;duplex.destroy();}else{cov_2fic4cdd6w().b[13][1]++;}}else{cov_2fic4cdd6w().b[12][1]++;cov_2fic4cdd6w().s[55]++;ws._socket.once('finish',function finish(){cov_2fic4cdd6w().f[14]++;cov_2fic4cdd6w().s[56]++;// `duplex` is not destroyed here because the `'end'` event will be
// emitted on `duplex` after this `'finish'` event. The EOF signaling
// `null` chunk is, in fact, pushed when the websocket emits `'close'`.
callback();});cov_2fic4cdd6w().s[57]++;ws.close();}};cov_2fic4cdd6w().s[58]++;duplex._read=function(){cov_2fic4cdd6w().f[15]++;cov_2fic4cdd6w().s[59]++;if((cov_2fic4cdd6w().b[15][0]++,ws.readyState===ws.OPEN)&&(cov_2fic4cdd6w().b[15][1]++,!resumeOnReceiverDrain)){cov_2fic4cdd6w().b[14][0]++;cov_2fic4cdd6w().s[60]++;resumeOnReceiverDrain=true;cov_2fic4cdd6w().s[61]++;if(!ws._receiver._writableState.needDrain){cov_2fic4cdd6w().b[16][0]++;cov_2fic4cdd6w().s[62]++;ws._socket.resume();}else{cov_2fic4cdd6w().b[16][1]++;}}else{cov_2fic4cdd6w().b[14][1]++;}};cov_2fic4cdd6w().s[63]++;duplex._write=function(chunk,encoding,callback){cov_2fic4cdd6w().f[16]++;cov_2fic4cdd6w().s[64]++;if(ws.readyState===ws.CONNECTING){cov_2fic4cdd6w().b[17][0]++;cov_2fic4cdd6w().s[65]++;ws.once('open',function open(){cov_2fic4cdd6w().f[17]++;cov_2fic4cdd6w().s[66]++;duplex._write(chunk,encoding,callback);});cov_2fic4cdd6w().s[67]++;return;}else{cov_2fic4cdd6w().b[17][1]++;}cov_2fic4cdd6w().s[68]++;ws.send(chunk,callback);};cov_2fic4cdd6w().s[69]++;duplex.on('end',duplexOnEnd);cov_2fic4cdd6w().s[70]++;duplex.on('error',duplexOnError);cov_2fic4cdd6w().s[71]++;return duplex;}cov_2fic4cdd6w().s[72]++;module.exports=createWebSocketStream;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0cmVhbS5qcyJdLCJuYW1lcyI6WyJEdXBsZXgiLCJyZXF1aXJlIiwiZW1pdENsb3NlIiwic3RyZWFtIiwiZW1pdCIsImR1cGxleE9uRW5kIiwiZGVzdHJveWVkIiwiX3dyaXRhYmxlU3RhdGUiLCJmaW5pc2hlZCIsImRlc3Ryb3kiLCJkdXBsZXhPbkVycm9yIiwiZXJyIiwicmVtb3ZlTGlzdGVuZXIiLCJsaXN0ZW5lckNvdW50IiwiY3JlYXRlV2ViU29ja2V0U3RyZWFtIiwid3MiLCJvcHRpb25zIiwicmVzdW1lT25SZWNlaXZlckRyYWluIiwicmVjZWl2ZXJPbkRyYWluIiwiX3NvY2tldCIsInJlc3VtZSIsInJlYWR5U3RhdGUiLCJDT05ORUNUSU5HIiwib25jZSIsIm9wZW4iLCJfcmVjZWl2ZXIiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJvbiIsImR1cGxleCIsImF1dG9EZXN0cm95Iiwib2JqZWN0TW9kZSIsIndyaXRhYmxlT2JqZWN0TW9kZSIsIm1lc3NhZ2UiLCJtc2ciLCJwdXNoIiwicGF1c2UiLCJlcnJvciIsImNsb3NlIiwiX2Rlc3Ryb3kiLCJjYWxsYmFjayIsIkNMT1NFRCIsInByb2Nlc3MiLCJuZXh0VGljayIsImNhbGxlZCIsInRlcm1pbmF0ZSIsIl9maW5hbCIsIl9yZWFkYWJsZVN0YXRlIiwiZW5kRW1pdHRlZCIsImZpbmlzaCIsIl9yZWFkIiwiT1BFTiIsIm5lZWREcmFpbiIsIl93cml0ZSIsImNodW5rIiwiZW5jb2RpbmciLCJzZW5kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsYSwyNldBZVk7MkZBYlosS0FBTSxDQUFFQSxNQUFGLDJCQUFhQyxPQUFPLENBQUMsUUFBRCxDQUFwQixDQUFOLENBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQ0EsUUFBU0MsQ0FBQUEsU0FBVCxDQUFtQkMsTUFBbkIsQ0FBMkIsaURBQ3pCQSxNQUFNLENBQUNDLElBQVAsQ0FBWSxPQUFaLEVBQ0QsQ0FFRDtBQUNBO0FB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LENBQXFDLHNEQUNuQ1AsRUFBRSxDQUFDUSxJQUFILENBQVEsTUFBUixDQUFnQixRQUFTQyxDQUFBQSxJQUFULEVBQWdCLG1EQUM5QkksTUFBTSxDQUFDd0IsTUFBUCxDQUFjQyxLQUFkLENBQXFCQyxRQUFyQixDQUErQmYsUUFBL0IsRUFDRCxDQUZELEVBRG1DLHlCQUluQyxPQUNELENBTEQsa0NBRG1ELHlCQVFuRHhCLEVBQUUsQ0FBQ3dDLElBQUgsQ0FBUUYsS0FBUixDQUFlZCxRQUFmLEVBQ0QsQ0FURCxDQXBHMEMseUJBK0cxQ1gsTUFBTSxDQUFDRCxFQUFQLENBQVUsS0FBVixDQUFpQnRCLFdBQWpCLEVBL0cwQyx5QkFnSDFDdUIsTUFBTSxDQUFDRCxFQUFQLENBQVUsT0FBVixDQUFtQmpCLGFBQW5CLEVBaEgwQyx5QkFpSDFDLE1BQU9rQixDQUFBQSxNQUFQLENBQ0QsQyx5QkFFRDRCLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQjNDLHFCQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgeyBEdXBsZXggfSA9IHJlcXVpcmUoJ3N0cmVhbScpO1xuXG4vKipcbiAqIEVtaXRzIHRoZSBgJ2Nsb3NlJ2AgZXZlbnQgb24gYSBzdHJlYW0uXG4gKlxuICogQHBhcmFtIHtzdHJlYW0uRHVwbGV4fSBUaGUgc3RyZWFtLlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gZW1pdENsb3NlKHN0cmVhbSkge1xuICBzdHJlYW0uZW1pdCgnY2xvc2UnKTtcbn1cblxuLyoqXG4gKiBUaGUgbGlzdGVuZXIgb2YgdGhlIGAnZW5kJ2AgZXZlbnQuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gZHVwbGV4T25FbmQoKSB7XG4gIGlmICghdGhpcy5kZXN0cm95ZWQgJiYgdGhpcy5fd3JpdGFibGVTdGF0ZS5maW5pc2hlZCkge1xuICAgIHRoaXMuZGVzdHJveSgpO1xuICB9XG59XG5cbi8qKlxuICogVGhlIGxpc3RlbmVyIG9mIHRoZSBgJ2Vycm9yJ2AgZXZlbnQuXG4gKlxuICogQHBhcmFtIHtFcnJvcn0gZXJyIFRoZSBlcnJvclxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gZHVwbGV4T25FcnJvcihlcnIpIHtcbiAgdGhpcy5yZW1vdmVMaXN0ZW5lcignZXJyb3InLCBkdXBsZXhPbkVycm9yKTtcbiAgdGhpcy5kZXN0cm95KCk7XG4gIGlmICh0aGlzLmxpc3RlbmVyQ291bnQoJ2Vycm9yJykgPT09IDApIHtcbiAgICAvLyBEbyBub3Qgc3VwcHJlc3MgdGhlIHRocm93aW5nIGJlaGF2aW9yLlxuICAgIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICB9XG59XG5cbi8qKlxuICogV3JhcHMgYSBgV2ViU29ja2V0YCBpbiBhIGR1cGxleCBzdHJlYW0uXG4gKlxuICogQHBhcmFtIHtXZWJTb2NrZXR9IHdzIFRoZSBgV2ViU29ja2V0YCB0byB3cmFwXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIFRoZSBvcHRpb25zIGZvciB0aGUgYER1cGxleGAgY29uc3RydWN0b3JcbiAqIEByZXR1cm4ge3N0cmVhbS5EdXBsZXh9IFRoZSBkdXBsZXggc3RyZWFtXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVdlYlNvY2tldFN0cmVhbSh3cywgb3B0aW9ucykge1xuICBsZXQgcmVzdW1lT25SZWNlaXZlckRyYWluID0gdHJ1ZTtcblxuICBmdW5jdGlvbiByZWNlaXZlck9uRHJhaW4oKSB7XG4gICAgaWYgKHJlc3VtZU9uUmVjZWl2ZXJEcmFpbikgd3MuX3NvY2tldC5yZXN1bWUoKTtcbiAgfVxuXG4gIGlmICh3cy5yZWFkeVN0YXRlID09PSB3cy5DT05ORUNUSU5HKSB7XG4gICAgd3Mub25jZSgnb3BlbicsIGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICB3cy5fcmVjZWl2ZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCdkcmFpbicpO1xuICAgICAgd3MuX3JlY2VpdmVyLm9uKCdkcmFpbicsIHJlY2VpdmVyT25EcmFpbik7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgd3MuX3JlY2VpdmVyLnJlbW92ZUFsbExpc3RlbmVycygnZHJhaW4nKTtcbiAgICB3cy5fcmVjZWl2ZXIub24oJ2RyYWluJywgcmVjZWl2ZXJPbkRyYWluKTtcbiAgfVxuXG4gIGNvbnN0IGR1cGxleCA9IG5ldyBEdXBsZXgoe1xuICAgIC4uLm9wdGlvbnMsXG4gICAgYXV0b0Rlc3Ryb3k6IGZhbHNlLFxuICAgIGVtaXRDbG9zZTogZmFsc2UsXG4gICAgb2JqZWN0TW9kZTogZmFsc2UsXG4gICAgd3JpdGFibGVPYmplY3RNb2RlOiBmYWxzZVxuICB9KTtcblxuICB3cy5vbignbWVzc2FnZScsIGZ1bmN0aW9uIG1lc3NhZ2UobXNnKSB7XG4gICAgaWYgKCFkdXBsZXgucHVzaChtc2cpKSB7XG4gICAgICByZXN1bWVPblJlY2VpdmVyRHJhaW4gPSBmYWxzZTtcbiAgICAgIHdzLl9zb2NrZXQucGF1c2UoKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdzLm9uY2UoJ2Vycm9yJywgZnVuY3Rpb24gZXJyb3IoZXJyKSB7XG4gICAgaWYgKGR1cGxleC5kZXN0cm95ZWQpIHJldHVybjtcblxuICAgIGR1cGxleC5kZXN0cm95KGVycik7XG4gIH0pO1xuXG4gIHdzLm9uY2UoJ2Nsb3NlJywgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgaWYgKGR1cGxleC5kZXN0cm95ZWQpIHJldHVybjtcblxuICAgIGR1cGxleC5wdXNoKG51bGwpO1xuICB9KTtcblxuICBkdXBsZXguX2Rlc3Ryb3kgPSBmdW5jdGlvbiAoZXJyLCBjYWxsYmFjaykge1xuICAgIGlmICh3cy5yZWFkeVN0YXRlID09PSB3cy5DTE9TRUQpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICBwcm9jZXNzLm5leHRUaWNrKGVtaXRDbG9zZSwgZHVwbGV4KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgY2FsbGVkID0gZmFsc2U7XG5cbiAgICB3cy5vbmNlKCdlcnJvcicsIGZ1bmN0aW9uIGVycm9yKGVycikge1xuICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSk7XG5cbiAgICB3cy5vbmNlKCdjbG9zZScsIGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgaWYgKCFjYWxsZWQpIGNhbGxiYWNrKGVycik7XG4gICAgICBwcm9jZXNzLm5leHRUaWNrKGVtaXRDbG9zZSwgZHVwbGV4KTtcbiAgICB9KTtcbiAgICB3cy50ZXJtaW5hdGUoKTtcbiAgfTtcblxuICBkdXBsZXguX2ZpbmFsID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgaWYgKHdzLnJlYWR5U3RhdGUgPT09IHdzLkNPTk5FQ1RJTkcpIHtcbiAgICAgIHdzLm9uY2UoJ29wZW4nLCBmdW5jdGlvbiBvcGVuKCkge1xuICAgICAgICBkdXBsZXguX2ZpbmFsKGNhbGxiYWNrKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSB2YWx1ZSBvZiB0aGUgYF9zb2NrZXRgIHByb3BlcnR5IGlzIGBudWxsYCBpdCBtZWFucyB0aGF0IGB3c2AgaXMgYVxuICAgIC8vIGNsaWVudCB3ZWJzb2NrZXQgYW5kIHRoZSBoYW5kc2hha2UgZmFpbGVkLiBJbiBmYWN0LCB3aGVuIHRoaXMgaGFwcGVucywgYVxuICAgIC8vIHNvY2tldCBpcyBuZXZlciBhc3NpZ25lZCB0byB0aGUgd2Vic29ja2V0LiBXYWl0IGZvciB0aGUgYCdlcnJvcidgIGV2ZW50XG4gICAgLy8gdGhhdCB3aWxsIGJlIGVtaXR0ZWQgYnkgdGhlIHdlYnNvY2tldC5cbiAgICBpZiAod3MuX3NvY2tldCA9PT0gbnVsbCkgcmV0dXJuO1xuXG4gICAgaWYgKHdzLl9zb2NrZXQuX3dyaXRhYmxlU3RhdGUuZmluaXNoZWQpIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgICBpZiAoZHVwbGV4Ll9yZWFkYWJsZVN0YXRlLmVuZEVtaXR0ZWQpIGR1cGxleC5kZXN0cm95KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdzLl9zb2NrZXQub25jZSgnZmluaXNoJywgZnVuY3Rpb24gZmluaXNoKCkge1xuICAgICAgICAvLyBgZHVwbGV4YCBpcyBub3QgZGVzdHJveWVkIGhlcmUgYmVjYXVzZSB0aGUgYCdlbmQnYCBldmVudCB3aWxsIGJlXG4gICAgICAgIC8vIGVtaXR0ZWQgb24gYGR1cGxleGAgYWZ0ZXIgdGhpcyBgJ2ZpbmlzaCdgIGV2ZW50LiBUaGUgRU9GIHNpZ25hbGluZ1xuICAgICAgICAvLyBgbnVsbGAgY2h1bmsgaXMsIGluIGZhY3QsIHB1c2hlZCB3aGVuIHRoZSB3ZWJzb2NrZXQgZW1pdHMgYCdjbG9zZSdgLlxuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSk7XG4gICAgICB3cy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICBkdXBsZXguX3JlYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHdzLnJlYWR5U3RhdGUgPT09IHdzLk9QRU4gJiYgIXJlc3VtZU9uUmVjZWl2ZXJEcmFpbikge1xuICAgICAgcmVzdW1lT25SZWNlaXZlckRyYWluID0gdHJ1ZTtcbiAgICAgIGlmICghd3MuX3JlY2VpdmVyLl93cml0YWJsZVN0YXRlLm5lZWREcmFpbikgd3MuX3NvY2tldC5yZXN1bWUoKTtcbiAgICB9XG4gIH07XG5cbiAgZHVwbGV4Ll93cml0ZSA9IGZ1bmN0aW9uIChjaHVuaywgZW5jb2RpbmcsIGNhbGxiYWNrKSB7XG4gICAgaWYgKHdzLnJlYWR5U3RhdGUgPT09IHdzLkNPTk5FQ1RJTkcpIHtcbiAgICAgIHdzLm9uY2UoJ29wZW4nLCBmdW5jdGlvbiBvcGVuKCkge1xuICAgICAgICBkdXBsZXguX3dyaXRlKGNodW5rLCBlbmNvZGluZywgY2FsbGJhY2spO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgd3Muc2VuZChjaHVuaywgY2FsbGJhY2spO1xuICB9O1xuXG4gIGR1cGxleC5vbignZW5kJywgZHVwbGV4T25FbmQpO1xuICBkdXBsZXgub24oJ2Vycm9yJywgZHVwbGV4T25FcnJvcik7XG4gIHJldHVybiBkdXBsZXg7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlV2ViU29ja2V0U3RyZWFtO1xuIl19